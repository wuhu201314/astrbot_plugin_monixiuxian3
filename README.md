# AstrBot 插件：文字修仙 (模拟修仙 Lite v2)

> **版本:** v2.0.0
> **许可证:** AGPL-3.0
> **基于:** [nonebot_plugin_xiuxian_2](https://github.com/xiuxian-2/nonebot_plugin_xiuxian_2) (部分借鉴与重构)

---

## 📅 v2.0.0 重构版特性

v2.0.0 是一个里程碑式的版本，我们将 AstrBot 修仙插件进行了彻底的重构，实现了与 NoneBot2 版修仙插件的功能对齐，带来了更丰富、更硬核的修仙体验！

### 🔥 新增核心玩法
- **宗门系统**：创建/加入宗门，职位管理（宗主/长老/弟子），宗门建设与捐献，宗门任务与资源掠夺。
- **战斗系统**：全新重构的战斗引擎，支持 HP/MP/ATK/暴击/防御 真实计算。支持 PVP（决斗/切磋）和 PVE。
- **世界 Boss**：全服 Boss 降临，定时刷新，多人合力讨伐，按伤害排名瓜分灵石奖励。
- **秘境探索**：挂机式秘境探索，消耗时间获取丰厚修为与灵石，偶遇随机奇遇事件。
- **历练系统**：离线挂机获取收益，让修仙更轻松。
- **炼丹系统**：收集材料炼制丹药，提升修为、恢复状态或增加属性。
- **传承系统**：查看特殊的传承 Buff 加成。

### ⚡ 原有功能优化
- **配置与数据**：全面优化的数据库结构（SQLite），支持自动迁移。配置文件外部化（JSON），支持动态调整游戏平衡性。
- **装备与商店**：保留并优化了原有的装备系统、储物戒系统和商店系统。

---

## 📖 玩法详解

### 1. 境界与修炼
- **境界划分**: 练气 -> 筑基 -> 金丹 -> 元婴 -> 化神 -> 炼虚 -> 合体 -> 大乘 -> 渡劫。
- **修炼方式**: 使用 `/修炼` (或 `/闭关`) 开始挂机，每分钟获得基于境界和聚灵阵等级的修为。
- **突破**: 当修为达到瓶颈时，使用 `/突破` 尝试晋升。高境界突破需要[破境丹]辅助，否则成功率极低甚至失败扣除修为。

### 2. 战斗系统
- **核心属性**:
  - **HP (气血)**: 归零时战败，重伤。
  - **MP (真元)**: 释放强力功法或技能消耗。
  - **ATK (攻击)**: 基础伤害来源，受境界、武器、功法加成。
  - **Defense (防御)**: 减免受到的伤害。
  - **Crit (会心)**: 暴击造成 1.5 倍伤害。
- **PVP**: 
  - `/切磋`: 点到为止，不消耗状态。
  - `/决斗`: 生死相搏，胜者可获得声望（未来版本），败者重伤（HP降为1）。

### 3. 宗门建设
- **创建**: 达到一定境界并缴纳灵石可自立门户。
- **职位**: 宗主 > 长老 > 亲传弟子 > 内门弟子 > 外门弟子。职位越高权限越大。
- **建设度**: 成员通过 `/宗门捐献` 或 `/宗门任务` 增加建设度，用于升级宗门设施（丹房、灵脉）。
- **福利**: 高等级宗门提供更高的修炼速度加成和每日俸禄。

### 4. 炼丹与资源
- **药材获取**: 通过 `/探索秘境` 或商店购买获取灵草等素材。
- **炼丹**: 使用 `/炼丹 <丹药ID>`。成功率受炼丹师等级和境界影响，境界压制可提高成功率。
- **丹药效果**: 
  - 恢复类：回血/回蓝。
  - 增益类：短时间增加攻击/防御。
  - 修为类：直接增加修为。
  - 破境类：增加突破成功率。

---

## 📜 指令列表

### 🟢 基础与个人
| 指令 | 说明 |
|-----|------|
| `我要修仙` | 创建角色（踏入仙途） |
| `我的信息` | 查看个人属性、境界、战力 |
| `签到` | 每日签到获取灵石/修为 |
| `修炼` / `闭关` | 开始修练（挂机） |
| `出关` | 结束修练，结算收益 |
| `突破` | 尝试突破当前境界（需修为足够） |
| `突破信息` | 查看当前境界突破概率与需求 |

### 🔴 战斗与交互 (PVP)
| 指令 | 说明 |
|-----|------|
| `切磋 <@某人>` | 友谊切磋，不消耗气血真元 |
| `决斗 <@某人>` | 生死决斗，败者重伤，消耗气血真元 |
| `排行榜` | 查看战力/境界/灵石/宗门排行榜（`境界排行`, `战力排行` 等） |

### 🏫 宗门系统
| 指令 | 说明 |
|-----|------|
| `创建宗门 <名称>` | 创建新宗门（需灵石与境界要求） |
| `加入宗门 <名称>` | 加入已有宗门 |
| `退出宗门` | 退出当前宗门 |
| `宗门信息` | 查看所在宗门详情与成员 |
| `宗门列表` | 查看全服宗门 |
| `宗门捐献 <数量>` | 捐献灵石增加宗门建设度与个人贡献 |
| `宗门任务` | 执行宗门日常任务，获取贡献与资材 |
| `宗门职位变更` | (宗主/长老) 管理成员职位 |
| `踢出宗门` | (宗主/长老) 踢人 |
| `宗主传位` | (宗主) 转让宗主之位 |

### 👹 Boss 与 PVE
| 指令 | 说明 |
|-----|------|
| `世界Boss` | 查看当前世界 Boss 状态 |
| `挑战Boss` | 挑战世界 Boss（消耗气血） |
| `生成Boss` | (管理员) 手动生成 Boss |

### 🏞️ 秘境与历练
| 指令 | 说明 |
|-----|------|
| `秘境列表` | 查看开放的秘境 |
| `探索秘境 <ID>` | 进入秘境探索（持续一段时间） |
| `完成探索` | 结算秘境奖励 |
| `开始历练` |开始外出游历（挂机） |
| `完成历练` | 结束游历并结算 |
| `历练状态` | 查看当前历练进度 |

### 💊 炼丹与物品
| 指令 | 说明 |
|-----|------|
| `丹药配方` | 查看可炼制的丹药 |
| `炼丹 <ID>` | 消耗材料炼制丹药 |
| `我的装备` | 查看背包与装备 |
| `装备/卸下` | 穿戴/卸下装备 |
| `储物戒` | 管理随身物品 |
| `丹阁/器阁/百宝阁` | 购买修仙资源 |

---

## ⚙️ 配置说明

插件首次运行后，将在 `data/plugins/astrbot_plugin_xiuxian_lite/config/` 目录下自动生成默认配置文件。您可以修改 JSON 文件来调整游戏平衡性：

| 配置文件 | 作用 |
|---------|------|
| `sect_config.json` | 宗门创建消耗、职位权限、任务奖励 |
| `boss_config.json` | Boss 属性成长曲线、生成间隔 (默认3600秒) |
| `rift_config.json` | 秘境名称、等级要求、探索时长、奖励池 |
| `alchemy_config.json` | 丹药配方、材料消耗、成功率计算公式参数 |

**注意**：修改配置后需重启 AstrBot 生效。

### 🖼️ 开启图片卡片 (可选)
本插件支持生成类似 NoneBot2 版的精美个人信息卡片。
1. **安装依赖**: 指令运行 `pip install Pillow`。
2. **获取素材**: 下载[卡图资源包](https://cowtransfer.com/s/82b90d2b879d43) (口令：k3jzr5)。
3. **放置素材**: 解压后将 `xiuxian` 文件夹放入 AstrBot 的 `data/` 目录中 (即 `data/xiuxian/info_img/*.png`)。
4. **生效验证**: 发送 `/我的信息`，若配置正确将发送图片，否则回退为文字。

---

## 🛠️ 安装与部署

1. 确保已安装 AstrBot。
2. 将插件文件夹放入 `data/plugins/` 目录。
3. 安装依赖（如有）。
4. 在 AstrBot 控制台启用插件。
5. 发送 `我要修仙` 开始体验！

---

## 🤝 致谢

本插件 v2.0.0 版本深度参考了 [NoneBot-Plugin-Xiuxian-2](https://github.com/xiuxian-2/nonebot_plugin_xiuxian_2) 的设计思路与数值体系，在此向原作者及贡献者致以崇高敬意！

- **原 AstrBot 插件维护者**: [linjianyan0229](https://github.com/linjianyan0229)
- **重构与开发**: AstrBot Agent (Antigravity)
