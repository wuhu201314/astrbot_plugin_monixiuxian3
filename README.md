# AstrBot 插件：模拟修仙 v2

<p align="center">
  <img src="logo.png" alt="模拟修仙" width="200">
</p>

> **版本:** v2.6.0  
> **许可证:** AGPL-3.0  
> **作者:** xiaojuwa  
> **基于:** [nonebot_plugin_xiuxian_2](https://github.com/xiuxian-2/nonebot_plugin_xiuxian_2) (部分借鉴与重构)

一款为 AstrBot 设计的、功能丰富的放置类修仙游戏插件。让你在聊天群中体验从凡人到大能的修行之路，工作摸鱼、畅聊吹水的同时亦可得道飞升！

---

## 🌟 特色功能

### 核心玩法
| 系统 | 说明 |
|------|------|
| **境界修炼** | 练气→筑基→金丹→元婴→化神→炼虚→合体→大乘→渡劫，九大境界逐步突破 |
| **战斗系统** | HP/MP/ATK/暴击/防御 真实计算，支持 PVP（切磋/决斗）和 PVE |
| **宗门系统** | 创建/加入宗门，职位管理，宗门建设与捐献 |
| **世界Boss** | 全服Boss降临，多人合力讨伐，按伤害排名瓜分奖励 |
| **秘境探索** | 挂机式秘境探索，获取丰厚修为与灵石 |
| **历练系统** | 离线挂机获取收益，短途/中途/长途三种时长 |
| **炼丹系统** | 收集材料炼制丹药，提升修为或增加属性 |
| **传承系统** | 传承挑战争夺Buff加成，传承排行榜竞技 |

### 独有系统
| 系统 | 说明 |
|------|------|
| **🏔️ 洞天福地** | 个人修炼空间，5档洞天可选，持续产出灵石和修为 |
| **🌾 灵田种植** | 开垦灵田种植灵草，5种灵草不同收益周期 |
| **💕 双修系统** | 与他人双修互增10%修为，1小时冷却 |
| **👁️ 天地灵眼** | 抢占灵眼持续获益，PVP资源争夺玩法 |

---

## 📜 指令大全

### 📖 入门 & 基础
| 指令 | 说明 |
|------|------|
| `我要修仙 [灵修/体修]` | 创建角色，灵修擅法术，体修擅肉身 |
| `我的信息` | 显示境界、修为、战力、装备等完整面板 |
| `签到` | 每日领取灵石(50-200)和修为奖励 |
| `改道号 <名称>` | 修改你的仙道称号 |

### 🧘 修炼突破
| 指令 | 说明 |
|------|------|
| `闭关` | 开始闭关修炼，离线也可积累修为 |
| `出关` | 结算闭关时间，获取对应修为 |
| `突破信息` | 查看当前境界突破所需修为、成功率、风险 |
| `突破 [丹药名]` | 尝试突破，可服用丹药增加成功率 |

### 🎒 装备丹药
| 指令 | 说明 |
|------|------|
| `我的装备` | 显示已装备的武器/防具/心法 |
| `装备 <名>` | 从储物戒装备到身上 |
| `卸下 <名>` | 卸下装备放回储物戒 |
| `丹药背包` | 查看拥有的丹药及效果 |
| `服用丹药 <名>` | 使用丹药获得增益 |

### 🏪 商店系统
| 指令 | 说明 |
|------|------|
| `丹阁` | 丹药专卖(破境丹/修为丹/功能丹) |
| `器阁` | 装备专卖(武器/防具/饰品) |
| `百宝阁` | 综合商店(功法/材料/杂物) |
| `购买 <物品名> [数量]` | 从当前商店购买物品 |
| `储物戒` | 查看你的储物空间和物品（分类显示） |
| `存入 <物品名> [数量]` | 存入物品到储物戒 |
| `取出 <物品名> [数量]` | 从储物戒取出物品 |
| `搜索物品 <关键词>` | 模糊搜索储物戒物品 |
| `取出所有 <分类>` | 批量取出指定分类（材料/装备/功法/其他） |
| `更换储物戒 <名称>` | 升级储物戒（需支付灵石） |
| `赠予 <@某人> <物品> [数量]` | 将物品赠送给其他玩家 |

### 🏦 灵石银行
年利率5%，每日复利

| 指令 | 说明 |
|------|------|
| `银行` | 查看存款余额和待领利息 |
| `存灵石 <数量>` | 存入灵石，开始计息 |
| `取灵石 <数量>` | 取出存款 |
| `领取利息` | 每日可领一次利息 |

### 📜 悬赏任务
| 指令 | 说明 |
|------|------|
| `悬赏令` | 查看当前可接取的悬赏任务 |
| `接取悬赏 <编号>` | 接取指定任务 |
| `悬赏状态` | 查看任务进度 |
| `完成悬赏` | 提交任务领取奖励 |
| `放弃悬赏` | 放弃当前任务 |

### 🏛️ 宗门系统
| 指令 | 说明 |
|------|------|
| `创建宗门 <名>` | 消耗灵石创建宗门 |
| `加入宗门 <名>` | 加入已有宗门 |
| `我的宗门` | 查看宗门信息和成员 |
| `宗门列表` | 查看所有宗门排名 |
| `退出宗门` | 退出当前宗门 |
| `宗门捐献 <数量>` | 捐献灵石增加宗门建设度 |

### ⚔️ 战斗竞技
| 指令 | 说明 |
|------|------|
| `切磋 <@某人>` | 友好切磋，无损失 |
| `决斗 <@某人>` | 生死之战，败者损修为 |
| `世界Boss` | 查看Boss信息和血量 |
| `挑战Boss` | 挑战Boss获取丰厚奖励 |
| `传承挑战 <@某人>` | 争夺对方传承加成 |
| `传承排行` | 查看传承榜 |

### 📊 排行榜
| 指令 | 说明 |
|------|------|
| `境界排行` | 查看境界排行榜 |
| `战力排行` | 查看战力排行榜 |
| `灵石排行` | 查看灵石排行榜 |
| `宗门排行` | 查看宗门排行榜 |

### 🚶 历练系统
| 指令 | 说明 |
|------|------|
| `开始历练 [短途/中途/长途]` | 短途30分/中途1小时/长途2小时 |
| `历练状态` | 查看历练进度 |
| `完成历练` | 领取历练奖励 |
| `历练信息` | 查看事件概率说明 |

### 🌀 秘境探索
| 指令 | 说明 |
|------|------|
| `秘境列表` | 查看可探索秘境及奖励 |
| `探索秘境 <ID>` | 进入秘境探险 |
| `完成探索` | 领取秘境奖励 |
| `退出秘境` | 放弃探索(无奖励) |

### 🔥 炼丹系统
| 指令 | 说明 |
|------|------|
| `丹药配方` | 查看炼丹配方及成功率 |
| `炼丹 <配方ID>` | 炼制丹药 |

### ✨ 传承系统
| 指令 | 说明 |
|------|------|
| `传承信息` | 查看传承给你的属性加成 |

### 🏔️ 洞天福地
| 指令 | 说明 |
|------|------|
| `我的洞天` | 查看洞天信息和待收取收益 |
| `购买洞天 <1-5>` | 1:小洞天 2:中洞天 3:大洞天 4:福地 5:洞天福地 |
| `升级洞天` | 提升洞天等级增加收益 |
| `洞天收取` | 收取灵石和修为产出 |

**洞天类型：**
| 类型 | 价格 | 修炼加成 |
|------|------|----------|
| 小洞天 | 10,000灵石 | +5% |
| 中洞天 | 50,000灵石 | +10% |
| 大洞天 | 200,000灵石 | +20% |
| 福地 | 500,000灵石 | +30% |
| 洞天福地 | 1,000,000灵石 | +50% |

### 🌾 灵田种植
| 指令 | 说明 |
|------|------|
| `我的灵田` | 查看灵田和种植情况 |
| `开垦灵田` | 花费灵石开垦灵田 |
| `种植 <灵草名>` | 种植灵草 |
| `收获` | 收获成熟的灵草获取修为 |
| `升级灵田` | 增加种植格数 |

**可种植灵草：**
| 灵草 | 成熟时间 | 修为收益 |
|------|----------|----------|
| 灵草 | 1小时 | +500 |
| 血灵草 | 2小时 | +1,500 |
| 冰心草 | 4小时 | +4,000 |
| 火焰花 | 8小时 | +10,000 |
| 九叶灵芝 | 24小时 | +30,000 |

### 💕 双修系统
| 指令 | 说明 |
|------|------|
| `双修 <@某人>` | 向对方发起双修请求 |
| `接受双修` | 接受双修，双方各获10%修为 |
| `拒绝双修` | 拒绝对方请求 |

### 👁️ 天地灵眼
| 指令 | 说明 |
|------|------|
| `灵眼信息` | 查看灵眼及可抢占列表 |
| `抢占灵眼 <ID>` | 占据无主灵眼 |
| `灵眼收取` | 收取灵眼修为产出 |
| `释放灵眼` | 释放已占据的灵眼 |

---

## ⚙️ 配置说明

插件首次运行后，将在 `data/plugins/astrbot_plugin_monixiuxian2/config/` 目录下自动生成默认配置文件：

| 配置文件 | 作用 |
|---------|------|
| `sect_config.json` | 宗门创建消耗、职位权限、任务奖励 |
| `boss_config.json` | Boss 属性成长曲线、生成间隔 |
| `rift_config.json` | 秘境名称、等级要求、探索时长、奖励池 |
| `alchemy_config.json` | 丹药配方、材料消耗、成功率计算 |

**注意**：修改配置后需重启 AstrBot 生效。

---

## 🖼️ 开启图片卡片 (可选)

本插件支持生成精美个人信息卡片：

1. **安装依赖**: `pip install Pillow`
2. **获取素材**: 下载[卡图资源包](https://cowtransfer.com/s/82b90d2b879d43) (口令：k3jzr5)
3. **放置素材**: 解压后将 `xiuxian` 文件夹放入 AstrBot 的 `data/` 目录中
4. **生效验证**: 发送 `/我的信息`，若配置正确将发送图片

---

## 🛠️ 安装与部署

1. 确保已安装 AstrBot
2. 将插件文件夹放入 `data/plugins/` 目录
3. 安装依赖：`pip install -r requirements.txt`
4. 在 AstrBot 控制台启用插件
5. 发送 `我要修仙` 开始体验！

---

## 📁 项目结构

```
astrbot_plugin_monixiuxian2/
├── main.py              # 插件入口
├── models.py            # 数据模型
├── config_manager.py    # 配置管理
├── handlers/            # 指令处理器
│   ├── player_handler.py        # 玩家基础
│   ├── breakthrough_handler.py  # 突破系统
│   ├── combat_handlers.py       # 战斗系统
│   ├── sect_handlers.py         # 宗门系统
│   ├── boss_handlers.py         # Boss系统
│   ├── rift_handlers.py         # 秘境系统
│   ├── adventure_handlers.py    # 历练系统
│   ├── alchemy_handlers.py      # 炼丹系统
│   ├── bank_handlers.py         # 银行系统
│   ├── bounty_handlers.py       # 悬赏系统
│   ├── shop_handler.py          # 商店系统
│   ├── blessed_land_handlers.py # 洞天福地
│   ├── spirit_farm_handlers.py  # 灵田系统
│   ├── spirit_eye_handlers.py   # 灵眼系统
│   └── dual_cultivation_handlers.py # 双修系统
├── managers/            # 业务逻辑管理器
├── config/              # 配置文件
├── data/                # 数据文件
└── utils/               # 工具函数
```

---

## 🤝 致谢

- **原版参考**: [NoneBot-Plugin-Xiuxian-2](https://github.com/xiuxian-2/nonebot_plugin_xiuxian_2)
- **原 AstrBot 插件维护者**: [linjianyan0229](https://github.com/linjianyan0229)

---

## 📝 更新日志

### v2.6.0 - 突破系统完善

**🎯 核心改造：突破丹药体系重构，全境界覆盖**

**💊 专属破境丹完善**
| 新增丹药 | 目标境界 | 加成效果 |
|---------|----------|---------|
| 固基丹·中/后 | 筑基期内部突破 | +50%/+60% |
| 温丹丹·中/后 | 金丹期内部突破 | +70%/+72% |
| 养婴丹·中/后 | 元婴期内部突破 | +76%/+74% |
| 温神丹·中/后 | 化神期内部突破 | +77%/+78% |
| 破虚丹·中/后 | 炼虚期内部突破 | +79%/+77% |
| 融合丹·中/后 | 合体期内部突破 | +72%/+70% |
| 悟道丹·中/后 | 大乘期内部突破 | +62%/+58% |
| 混元丹 | 混元大罗金仙 | +5% |

**🔄 通用增益丹体系**
- 原"三品筑基丹"等改名为"xx增益丹"，明确定位为通用突破辅助
- 无境界限制，购买后获得1小时临时突破成功率加成
- 可与专属破境丹叠加使用

**🌀 秘境稀有丹药掉落**
| 秘境等级 | 掉落概率 | 可掉落丹药 |
|----------|----------|-----------|
| 低级秘境 | 3% | 三品凝神增益丹 |
| 中级秘境 | 5% | 三/四/五品增益丹 |
| 高级秘境 | 10% | 四/五/六/七品增益丹 |

**🔧 修复问题**
- 修复items.json中`add_breakthrough_bonus`未生效的问题
- 通用增益丹购买后正确添加临时突破加成效果

---

### v2.5.0 - 储物戒系统重构

**🎯 核心改造：储物戒成为游戏物品流转的中央枢纽**

**📦 系统联动（8个系统接入）**
| 系统 | 入库场景 | 出库场景 |
|------|---------|---------|
| 商店系统 | 购买物品→自动存入 | - |
| 装备系统 | 卸下装备→存入 | 装备→从储物戒取出 |
| 炼丹系统 | - | 炼丹→消耗储物戒材料 |
| 历练系统 | 完成历练→物品掉落 | - |
| 秘境系统 | 探索完成→物品掉落 | - |
| Boss系统 | 击杀奖励→物品掉落 | - |
| 悬赏系统 | 完成悬赏→物品奖励 | - |
| 灵田系统 | 收获灵草→存入储物戒 | - |

**🆕 新增功能**
- 物品分类视图：按材料/装备/功法/其他分组显示
- 物品搜索：`搜索物品 关键词` 模糊搜索
- 批量取出：`取出所有 分类` 批量操作
- 储物戒升级消耗：需支付灵石购买

**🔧 修复问题**
- 炼丹现在正确消耗储物戒中的灵草材料
- 装备物品必须先存在于储物戒中
- 赠予请求持久化到数据库（24小时有效期）

---

## 📄 许可证

本项目采用 [AGPL-3.0](LICENSE) 许可证。
